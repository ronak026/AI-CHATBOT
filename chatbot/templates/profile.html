{% extends "base.html" %}
{% load widget_tweaks %}
{% block title %}Profile | AI Chatbot{% endblock %}

{% block content %}

<!-- Back Button -->
<div class="mb-6">
    <button onclick="history.back()"
            class="flex items-center gap-2 text-sm
                   text-gray-300 hover:text-[#00ADB5] transition">
        <i data-lucide="arrow-left" class="w-4 h-4 icon-hover"></i>
        Back
    </button>
</div>

<section class="max-w-3xl mx-auto">

    <!-- Profile Card -->
    <div class="bg-[#393E46]
                border border-[#00ADB5]/30
                rounded-3xl shadow-xl p-10
                transition hover:shadow-2xl">

        <!-- Success Messages (Only "success" type messages) -->
        {% if messages %}
            <div class="mb-8 space-y-3" id="messages-container">
                {% for message in messages %}
                    {% if message.tags == 'success' or not message.tags %}
                        <div class="message-alert
                                    text-sm text-green-400
                                    bg-green-900/20
                                    border border-green-500/40
                                    px-4 py-3 rounded-xl
                                    flex items-center gap-2
                                    animate-fade-in">
                            <i data-lucide="check-circle" class="w-5 h-5 flex-shrink-0"></i>
                            <span>{{ message }}</span>
                            <button type="button" 
                                    class="ml-auto text-green-400 hover:text-green-300"
                                    onclick="this.parentElement.remove()">
                                <i data-lucide="x" class="w-4 h-4"></i>
                            </button>
                        </div>
                    {% endif %}
                {% endfor %}
            </div>
        {% endif %}

        <!-- Header -->
        <div class="mb-10 border-b border-[#00ADB5]/20 pb-6">
            <h2 class="text-3xl font-extrabold flex items-center gap-3">
                <i data-lucide="user"
                   class="w-7 h-7 text-[#00ADB5] icon-hover"></i>
                My Profile
            </h2>
            <p class="text-gray-300 mt-2">
                Manage your personal information
            </p>
        </div>

        <!-- Profile Info -->
        <div class="flex items-center gap-6 mb-12">

            {% if user.avatar %}
                <img src="{{ user.avatar.url }}"
                     class="w-24 h-24 rounded-full object-cover
                            border-2 border-[#00ADB5]/50 shadow-lg
                            transition hover:scale-105">
            {% else %}
                <div class="w-24 h-24 rounded-full
                            bg-[#222831]
                            border-2 border-[#00ADB5]/50
                            flex items-center justify-center
                            text-[#00ADB5]
                            text-3xl font-bold
                            shadow-lg">
                    {{ user.username|first|upper }}
                </div>
            {% endif %}

            <div>
                <p class="text-xl font-semibold text-[#EEEEEE]">
                    {{ user.username }}
                </p>
                <p class="text-sm text-gray-300">
                    {{ user.email }}
                </p>

                <span class="inline-flex items-center gap-1 mt-3
                             px-3 py-1 text-xs rounded-full
                             bg-[#222831]
                             border border-[#00ADB5]/40
                             text-[#00ADB5]">
                    <i data-lucide="check-circle" class="w-3 h-3"></i>
                    Active User
                </span>
            </div>

        </div>

        <!-- Update Form -->
        <form method="POST"
              enctype="multipart/form-data"
              class="space-y-7">

            {% csrf_token %}

            {% for field in form %}
                <div>
                    <label for="{{ field.id_for_label }}" class="block text-sm font-medium mb-2 text-gray-200">
                        {{ field.label }}
                    </label>

                    {% if field.errors %}
                        {{ field|add_class:"w-full px-4 py-3 rounded-xl bg-[#222831] border-red-500/50 text-[#EEEEEE] placeholder-gray-400 focus:outline-none focus:border-red-500 focus:ring-1 focus:ring-red-500 transition" }}
                        <p class="text-sm text-red-400 mt-2 flex items-center gap-1">
                            <i data-lucide="alert-circle" class="w-4 h-4"></i>
                            {{ field.errors|striptags }}
                        </p>
                    {% else %}
                        {{ field|add_class:"w-full px-4 py-3 rounded-xl bg-[#222831] border border-[#00ADB5]/30 text-[#EEEEEE] placeholder-gray-400 focus:outline-none focus:border-[#00ADB5] focus:ring-1 focus:ring-[#00ADB5] transition" }}
                    {% endif %}
                </div>
            {% endfor %}

            <button type="submit"
                    class="w-full py-3 text-lg font-semibold
                           bg-[#00ADB5] text-black
                           rounded-xl
                           border border-[#00ADB5]
                           hover:bg-[#00c7d1]
                           active:scale-95
                           transition shadow-lg hover:shadow-xl
                           flex items-center justify-center gap-2">
                <i data-lucide="save" class="w-5 h-5"></i>
                Update Profile
            </button>
        </form>

    </div>

</section>

<style>
    @keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(-10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .animate-fade-in {
        animation: fadeIn 0.3s ease-out;
    }
</style>

<script>
    // Auto-hide success messages after 5 seconds
    document.addEventListener('DOMContentLoaded', function() {
        const messageAlerts = document.querySelectorAll('.message-alert');
        messageAlerts.forEach(alert => {
            setTimeout(() => {
                alert.style.transition = 'opacity 0.3s ease';
                alert.style.opacity = '0';
                setTimeout(() => alert.remove(), 300);
            }, 5000);
        });
    });
</script>

{% endblock %}